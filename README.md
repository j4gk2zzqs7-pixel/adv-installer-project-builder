# Advanced Installer Project Builder

Приложение с Python GUI интерфейсом для редактирования и управления проектами Advanced Installer (.aip файлы).

## Возможности

1. **Редактирование информации о проекте**
   - Изменение названия продукта
   - Изменение имени производителя
   - Обновление версии приложения
   - Автоматическое создание резервных копий

2. **Конвертация иконок**
   - Импорт изображений в форматах .png/.jpg/.jpeg
   - Автоматическая конвертация в форматы .ico и .bmp
   - Предварительный просмотр иконки
   - Автоматическое применение к проекту

3. **Сборка проектов**
   - Автоматическое определение установки Advanced Installer
   - Возможность указать путь вручную
   - Запуск сборки с отображением прогресса в реальном времени
   - Настройка папки вывода результатов

4. **Редактор PowerShell скриптов**
   - Загрузка и редактирование .ps1 файлов
   - Система версионирования
   - Создание именованных версий
   - Восстановление предыдущих версий
   - Автоматическое создание резервных копий при сохранении

## Структура проекта

```
adv-installer-project-builder/
├── src/
│   ├── core/
│   │   ├── __init__.py
│   │   ├── aip_manager.py       # Работа с .aip файлами
│   │   └── build_manager.py     # Управление сборкой проектов
│   ├── gui/
│   │   ├── __init__.py
│   │   └── main_window.py       # Главное окно приложения
│   └── utils/
│       ├── __init__.py
│       ├── image_converter.py   # Конвертация изображений
│       └── powershell_editor.py # Редактирование PS скриптов
├── tests/                       # Тесты (будут добавлены позже)
├── main.py                      # Точка входа в приложение
├── requirements.txt             # Зависимости Python
├── setup.py                     # Установочный скрипт
├── .gitignore                   # Игнорируемые файлы Git
└── README.md                    # Документация

```

## Требования

- **Python**: 3.8 или выше
- **ОС**: Windows (требуется для работы с Advanced Installer)
- **Advanced Installer**: Любая версия (опционально, для сборки проектов)

## Установка

### 1. Клонирование репозитория

```bash
git clone https://github.com/yourusername/adv-installer-project-builder.git
cd adv-installer-project-builder
```

### 2. Создание виртуального окружения (рекомендуется)

```bash
python -m venv venv

# Windows
venv\Scripts\activate

# Linux/Mac
source venv/bin/activate
```

### 3. Установка зависимостей

```bash
pip install -r requirements.txt
```

или

```bash
pip install -e .
```

## Запуск приложения

### Простой запуск

```bash
python main.py
```

### После установки через setup.py

```bash
aip-builder
```

## Использование

### 1. Загрузка проекта

1. Нажмите кнопку **"Обзор..."** в разделе "Проект Advanced Installer"
2. Выберите файл .aip вашего проекта
3. Нажмите **"Загрузить"**

### 2. Редактирование информации о проекте

1. Перейдите на вкладку **"Информация о проекте"**
2. Отредактируйте необходимые поля:
   - Название продукта
   - Производитель
   - Версия
3. Нажмите **"Сохранить изменения"**
4. При необходимости создайте резервную копию кнопкой **"Создать резервную копию"**

### 3. Конвертация иконок

1. Перейдите на вкладку **"Конвертация иконки"**
2. Нажмите **"Обзор..."** и выберите изображение (.png, .jpg, .jpeg)
3. Просмотрите предварительный показ иконки
4. Нажмите **"Конвертировать и применить к проекту"**
5. Иконка будет сконвертирована в .ico и .bmp форматы и добавлена в проект

### 4. Сборка проекта

1. Перейдите на вкладку **"Сборка проекта"**
2. Если Advanced Installer не был найден автоматически:
   - Укажите путь к AdvancedInstaller.com
   - Обычно находится в: `C:\Program Files (x86)\Caphyon\Advanced Installer\<version>\bin\x86\AdvancedInstaller.com`
3. (Опционально) Укажите папку для вывода результатов сборки
4. Нажмите **"Запустить сборку"**
5. Наблюдайте за процессом в окне вывода

### 5. Редактирование PowerShell скриптов

1. Перейдите на вкладку **"Редактор PowerShell"**
2. Нажмите **"Обзор..."** и выберите .ps1 файл
3. Нажмите **"Загрузить"**
4. Редактируйте скрипт в текстовом редакторе
5. Опции:
   - **"Сохранить"** - сохранить изменения (автоматически создается резервная копия)
   - **"Создать версию"** - создать именованную версию
   - **Двойной клик по версии в списке** - восстановить эту версию

## Зависимости

- **PyQt5** (>=5.15.0) - GUI фреймворк
- **Pillow** (>=9.0.0) - обработка изображений
- **pywin32** (>=305) - работа с Windows API и реестром

## Разработка

### Структура модулей

#### core/aip_manager.py
- Класс `AIPManager` для работы с .aip файлами (XML)
- Методы для чтения/записи свойств проекта
- Управление резервными копиями

#### core/build_manager.py
- Класс `BuildManager` для управления сборкой
- Автоматическое определение установки Advanced Installer
- Запуск процесса сборки с callback для вывода

#### utils/image_converter.py
- Класс `ImageConverter` для конвертации изображений
- Поддержка форматов PNG, JPG, JPEG → ICO, BMP
- Создание мультиразмерных .ico файлов

#### utils/powershell_editor.py
- Класс `PowerShellEditor` для работы со скриптами
- Система версионирования
- Автоматическое создание резервных копий

#### gui/main_window.py
- Главное окно приложения на PyQt5
- Вкладки для различных функций
- Асинхронная сборка в отдельном потоке

### Запуск тестов

```bash
# После добавления тестов
python -m pytest tests/
```

## Примеры использования

### Программное использование модулей

```python
from core.aip_manager import AIPManager
from utils.image_converter import ImageConverter

# Работа с AIP файлом
aip = AIPManager("path/to/project.aip")
info = aip.get_project_info()
print(f"Product: {info['ProductName']}")

# Обновление информации
aip.update_project_info(
    product_name="New Product Name",
    version="2.0.0"
)
aip.save()

# Конвертация иконки
converter = ImageConverter()
result = converter.convert_image_for_installer(
    "icon.png",
    "output_dir/",
    base_name="MyIcon"
)
print(f"Created: {result['ico']}, {result['bmp']}")
```

## Известные ограничения

- Работает только на Windows (требуется для Advanced Installer)
- Требует установленный Advanced Installer для сборки проектов
- Поддерживаются только .aip файлы формата XML

## Устранение неполадок

### Advanced Installer не найден

**Проблема**: Приложение не может найти Advanced Installer автоматически

**Решение**:
1. Перейдите на вкладку "Сборка проекта"
2. Вручную укажите путь к AdvancedInstaller.com
3. Стандартные пути:
   - `C:\Program Files (x86)\Caphyon\Advanced Installer\<version>\bin\x86\AdvancedInstaller.com`
   - `C:\Program Files\Caphyon\Advanced Installer\<version>\bin\x86\AdvancedInstaller.com`

### Ошибка при конвертации иконки

**Проблема**: Ошибка при конвертации изображения

**Решение**:
- Убедитесь, что файл является корректным изображением
- Поддерживаются только форматы: PNG, JPG, JPEG
- Проверьте права доступа к файлу и папке проекта

### Не сохраняются изменения в AIP файле

**Проблема**: Изменения не применяются к проекту

**Решение**:
- Убедитесь, что файл .aip не открыт в Advanced Installer
- Проверьте права доступа на запись
- Создайте резервную копию перед изменениями

## Лицензия

MIT License - свободное использование

## Контакты и поддержка

- **Issues**: https://github.com/yourusername/adv-installer-project-builder/issues
- **Email**: your.email@example.com

## Благодарности

- Advanced Installer от Caphyon
- PyQt5 сообщество
- Python Pillow разработчики
