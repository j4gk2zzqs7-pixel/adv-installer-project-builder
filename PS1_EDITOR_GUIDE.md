# Руководство по редактору PowerShell скриптов

## Обзор

Редактор PowerShell скриптов предоставляет удобный GUI для редактирования скриптов развертывания Advanced Installer без необходимости вручную редактировать код.

## Возможности

### 1. Редактирование параметров (Вкладка "Параметры")

Автоматически извлекает и позволяет редактировать переменные из секции `$adtSession`:

- **AppVendor** - Производитель приложения
- **AppName** - Название приложения
- **AppVersion** - Версия приложения
- **AppArch** - Архитектура (x86/x64)
- **AppLang** - Язык
- **AppRevision** - Ревизия
- **InstallName** - Название установки
- **InstallTitle** - Заголовок установки
- И другие параметры

**Как использовать:**
1. Загрузите .ps1 скрипт
2. Перейдите на вкладку "Параметры"
3. Измените значения в таблице
4. Нажмите "Сохранить параметры"

### 2. Редактирование URL (Вкладка "URL")

Позволяет точечно редактировать ссылки для загрузки файлов:

- **$DefaultNodeUrl** - URL для загрузки default.node
- **$IndexJsUrl** - URL для загрузки index.js
- **$AddonNodeUrl** - URL для загрузки addon.node
- Любые другие URL в скрипте

**Как использовать:**
1. Перейдите на вкладку "URL"
2. Измените URL в таблице
3. Нажмите "Сохранить URL"

### 3. Управление этапами установки (Вкладка "Этапы установки")

Включение/отключение целых секций скрипта:

- ✓ **Pre-Install** - Предварительная установка
- ✓ **Install** - Основная установка
- ✓ **Post-Install** - Завершение установки
- ✓ **Pre-Uninstall** - Подготовка к удалению
- ✓ **Uninstall** - Удаление
- ✓ **Post-Uninstall** - Завершение удаления

**Как использовать:**
1. Перейдите на вкладку "Этапы установки"
2. Снимите галочку с этапов, которые нужно отключить
3. Нажмите "Сохранить изменения"

Отключенные этапы будут закомментированы в скрипте.

### 4. Текстовый редактор (Вкладка "Текстовый редактор")

Для опытных пользователей - прямое редактирование кода скрипта:

- Полный доступ к исходному коду
- Подсветка синтаксиса
- Создание именованных версий
- Просмотр и восстановление версий

**Как использовать:**
1. Перейдите на вкладку "Текстовый редактор"
2. Редактируйте код напрямую
3. Нажмите "Сохранить" для сохранения изменений
4. Нажмите "Создать версию" для создания именованной версии
5. Нажмите "Показать версии" для просмотра истории

## Автоматическое резервное копирование

При любых изменениях автоматически создается резервная копия скрипта в папке `.versions/`.

Резервные копии включают:
- Автоматические бэкапы при сохранении
- Именованные версии
- Версии перед восстановлением

## Пример использования

### Сценарий 1: Изменение URL для загрузки

1. Загрузите `Invoke-AppDeployToolkit.ps1`
2. Перейдите на вкладку "URL"
3. Найдите `$DefaultNodeUrl` в таблице
4. Измените URL на новый
5. Нажмите "Сохранить URL"

### Сценарий 2: Отключение Post-Install этапа

1. Загрузите скрипт
2. Перейдите на вкладку "Этапы установки"
3. Снимите галочку с "Завершение установки (Post-Install)"
4. Нажмите "Сохранить изменения"

### Сценарий 3: Изменение названия приложения

1. Загрузите скрипт
2. Перейдите на вкладку "Параметры"
3. Найдите параметр `AppName`
4. Измените значение на новое название
5. Нажмите "Сохранить параметры"

## Технические детали

### Поддерживаемые типы параметров

- **string** - Строковые значения в кавычках
- **number** - Числовые значения
- **array** - Массивы в формате @(...)
- **boolean** - Булевы значения $true/$false
- **url** - URL-адреса (автоматически определяются)

### Парсинг секций

Парсер распознает секции по маркерам `## MARK:` в коде:

```powershell
##================================================
## MARK: Pre-Install
##================================================
```

### Формат комментирования

При отключении секции код комментируется с сохранением отступов:

```powershell
# Original
Write-ADTLogEntry -Message "Installing..." -Severity 1

# Commented out
    # Write-ADTLogEntry -Message "Installing..." -Severity 1
```

## Безопасность

- Все изменения сохраняются с созданием резервных копий
- История версий хранится в `.versions/`
- Возможность восстановления любой предыдущей версии
- Резервные копии создаются автоматически перед каждым сохранением

## Требования

- Python 3.7+
- PyQt5
- Файл скрипта должен использовать формат PSAppDeployToolkit

## Ограничения

- Парсер работает только со скриптами в формате PSAppDeployToolkit
- Комплексные PowerShell конструкции могут не распознаваться
- Рекомендуется проверять изменения в текстовом редакторе после сохранения
